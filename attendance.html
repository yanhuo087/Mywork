<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯è€ƒå‹¤æ‰“å¡ç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* é¡µé¢å®¹å™¨ */
        .container {
            max-width: 750px;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .tab-nav {
            display: flex;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn.active {
            color: #409eff;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #409eff;
            border-radius: 3px;
        }
        
        /* é¡µé¢å†…å®¹åŒºåŸŸ */
        .page {
            display: none;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            min-height: calc(100vh - 100px);
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç¬¬ä¸€é¡µï¼šæ‰“å¡ç™»è®°æ ·å¼ */
        .checkin-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            color: #333;
            text-align: center;
        }
        
        .checkin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .checkin-btn {
            height: 100px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .checkin-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .morning-checkin {
            background-color: #67c23a;
        }
        
        .afternoon-checkin {
            background-color: #1989fa;
        }
        
        .rest-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .rest-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        .rest-btn {
            height: 80px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            background-color: #909399;
        }
        
        .rest-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .rest-morning {
            background-color: #e6a23c;
        }
        
        .rest-afternoon {
            background-color: #f56c6c;
        }
        
        .rest-all {
            background-color: #722ed1;
        }
        
        .success-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            display: none;
            z-index: 9999;
            animation: toastFade 0.3s ease;
        }
        
        @keyframes toastFade {
            from { opacity: 0; transform: translate(-50%, -40%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        /* ç¬¬äºŒé¡µï¼šè®°å½•ç®¡ç†æ ·å¼ */
        .record-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            height: 45px;
            padding: 0 15px 0 40px;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .search-input:focus {
            border-color: #409eff;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 18px;
        }
        
        .record-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .action-btn {
            height: 40px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .add-btn { background-color: #67c23a; }
        .edit-btn { background-color: #409eff; }
        .delete-btn { background-color: #f56c6c; }
        .clear-btn { background-color: #e6a23c; }
        .export-btn { background-color: #722ed1; }
        
        .record-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .record-table th,
        .record-table td {
            padding: 12px 8px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .record-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #666;
        }
        
        .record-table tr:last-child td {
            border-bottom: none;
        }
        
        .record-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        /* ç¬¬ä¸‰é¡µï¼šå›¾å½¢åŒ–å±•ç¤ºæ ·å¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background-color: #409eff;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .month-btn:active {
            transform: scale(0.95);
        }
        
        .current-month {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-header-cell {
            text-align: center;
            padding: 10px 0;
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }
        
        .calendar-day {
            /* ä¿®å¤æ—¥å†å•å…ƒæ ¼é«˜åº¦é—®é¢˜ï¼Œä½¿ç”¨å›ºå®šé«˜åº¦è€Œéaspect-ratio */
            height: 60px;
            border: 1px solid #eee;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .day-number {
            padding: 3px;
            font-size: 12px;
            text-align: center;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .status-cell {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;  /* ç¼©å°å­—ä½“é€‚åº”å°å±å¹• */
            font-weight: bold;
            color: white;
        }
        
        .status-present {
            background-color: #67c23a;
        }
        
        .status-absent {
            background-color: #f56c6c;
        }
        
        .status-rest {
            background-color: #409eff;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: #fff;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            animation: modalFade 0.3s ease;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-label {
            font-size: 14px;
            color: #666;
        }
        
        .form-input, .form-select {
            height: 40px;
            padding: 0 15px;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            font-size: 16px;
            outline: none;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #409eff;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            height: 45px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .confirm-btn {
            background-color: #409eff;
            color: #fff;
        }
        
        .cancel-btn {
            background-color: #f5f7fa;
            color: #666;
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
            color: #999;
            font-size: 16px;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* é€‚é…å°å±æ‰‹æœº */
        @media (max-width: 375px) {
            .checkin-btn {
                height: 90px;
                font-size: 16px;
            }
            
            .rest-btn {
                height: 70px;
                font-size: 14px;
            }
            
            .record-table th,
            .record-table td {
                padding: 10px 5px;
                font-size: 12px;
            }
            
            /* æ—¥å†é€‚é…å°å±å¹• */
            .calendar-day {
                height: 50px;  /* è¿›ä¸€æ­¥å‡å°é«˜åº¦é€‚åº”æå°å±å¹• */
            }
            
            .status-cell {
                font-size: 12px;  /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
            }
            
            .day-number {
                font-size: 10px;
                padding: 2px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡ç­¾å¯¼èˆª -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchPage(0)">æ‰“å¡ç™»è®°</button>
            <button class="tab-btn" onclick="switchPage(1)">è®°å½•ç®¡ç†</button>
            <button class="tab-btn" onclick="switchPage(2)">æ‰“å¡æ—¥å†</button>
        </div>
        
        <!-- ç¬¬ä¸€é¡µï¼šæ‰“å¡ç™»è®° -->
        <div class="page active" id="page1">
            <h2 class="checkin-title">ä»Šæ—¥æ‰“å¡</h2>
            
            <div class="checkin-grid">
                <button class="checkin-btn morning-checkin" onclick="checkin('morning')">
                    ä¸Šåˆæ‰“å¡
                </button>
                <button class="checkin-btn afternoon-checkin" onclick="checkin('afternoon')">
                    ä¸‹åˆæ‰“å¡
                </button>
            </div>
            
            <h3 class="rest-title">ä¼‘ç­ç™»è®°</h3>
            <div class="rest-grid">
                <button class="rest-btn rest-morning" onclick="registerRest('morning')">
                    ä¸Šåˆä¼‘ç­
                </button>
                <button class="rest-btn rest-afternoon" onclick="registerRest('afternoon')">
                    ä¸‹åˆä¼‘ç­
                </button>
                <button class="rest-btn rest-all" onclick="registerRest('all')">
                    å…¨å¤©ä¼‘ç­
                </button>
            </div>
        </div>
        
        <!-- ç¬¬äºŒé¡µï¼šè®°å½•ç®¡ç† -->
        <div class="page" id="page2">
            <div class="record-controls">
                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢è®°å½•ï¼ˆæ—¥æœŸ/çŠ¶æ€ï¼‰" oninput="filterRecords()">
                </div>
                
                <div class="record-actions">
                    <button class="action-btn add-btn" onclick="openModal('add')">æ·»åŠ è®°å½•</button>
                    <button class="action-btn edit-btn" onclick="openModal('edit')">ç¼–è¾‘è®°å½•</button>
                    <button class="action-btn delete-btn" onclick="deleteRecord()">åˆ é™¤è®°å½•</button>
                    <button class="action-btn clear-btn" onclick="clearMonthRecords()">æ¸…é™¤æœˆåº¦è®°å½•</button>
                    <button class="action-btn export-btn" onclick="exportRecords()">å¯¼å‡ºExcel</button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="record-table" id="recordTable">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>æ—¥æœŸ</th>
                            <th>ä¸ŠåˆçŠ¶æ€</th>
                            <th>ä¸‹åˆçŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="recordBody">
                        <!-- è®°å½•å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ç¬¬ä¸‰é¡µï¼šå›¾å½¢åŒ–å±•ç¤º -->
        <div class="page" id="page3">
            <div class="calendar-header">
                <button class="month-btn" onclick="changeMonth(-1)">â—€</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-btn" onclick="changeMonth(1)">â–¶</button>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-header-cell">æ—¥</div>
                <div class="calendar-header-cell">ä¸€</div>
                <div class="calendar-header-cell">äºŒ</div>
                <div class="calendar-header-cell">ä¸‰</div>
                <div class="calendar-header-cell">å››</div>
                <div class="calendar-header-cell">äº”</div>
                <div class="calendar-header-cell">å…­</div>
                <!-- æ—¥å†å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- æ—¥æœŸæ ¼å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æˆåŠŸæç¤ºæ¡† -->
        <div class="success-toast" id="toast"></div>
        
        <!-- æ¨¡æ€æ¡† -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h3 class="modal-title" id="modalTitle">æ·»åŠ è®°å½•</h3>
                <form class="modal-form" id="recordForm">
                    <div class="form-group">
                        <label class="form-label">æ—¥æœŸ</label>
                        <input type="date" class="form-input" id="recordDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸ŠåˆçŠ¶æ€</label>
                        <select class="form-select" id="morningStatus">
                            <option value="æ‰“å¡">æ‰“å¡</option>
                            <option value="æœªæ‰“å¡">æœªæ‰“å¡</option>
                            <option value="ä¼‘ç­">ä¼‘ç­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸‹åˆçŠ¶æ€</label>
                        <select class="form-select" id="afternoonStatus">
                            <option value="æ‰“å¡">æ‰“å¡</option>
                            <option value="æœªæ‰“å¡">æœªæ‰“å¡</option>
                            <option value="ä¼‘ç­">ä¼‘ç­</option>
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
                        <button type="submit" class="modal-btn confirm-btn">ç¡®è®¤</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPage = 0;
        let checkinRecords = JSON.parse(localStorage.getItem('checkinRecords')) || [];
        let currentCalendarMonth = new Date();
        let selectedRecordId = null;
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageIndex) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach((page, index) => {
                page.classList.toggle('active', index === pageIndex);
            });
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index === pageIndex);
            });
            
            currentPage = pageIndex;
            
            // å¦‚æœåˆ‡æ¢åˆ°æ—¥å†é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“æ—¥å†
            if (pageIndex === 2) {
                renderCalendar();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°è®°å½•é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“è®°å½•
            if (pageIndex === 1) {
                renderRecords();
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }
        
        // æ‰“å¡åŠŸèƒ½
        function checkin(type) {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().split(' ')[0].substring(0, 8);
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ‰“å¡
            const existingRecord = checkinRecords.find(record => 
                record.date === dateStr && 
                ((type === 'morning' && record.morningStatus === 'æ‰“å¡') || 
                 (type === 'afternoon' && record.afternoonStatus === 'æ‰“å¡'))
            );
            
            if (existingRecord) {
                showToast(type === 'morning' ? 'ä¸Šåˆå·²æ‰“å¡' : 'ä¸‹åˆå·²æ‰“å¡');
                return;
            }
            
            // æ›´æ–°æˆ–æ·»åŠ è®°å½•
            let recordIndex = checkinRecords.findIndex(record => record.date === dateStr);
            
            if (recordIndex === -1) {
                // æ–°å»ºè®°å½•
                const newRecord = {
                    id: Date.now(),
                    date: dateStr,
                    morningStatus: type === 'morning' ? 'æ‰“å¡' : 'æœªæ‰“å¡',
                    afternoonStatus: type === 'afternoon' ? 'æ‰“å¡' : 'æœªæ‰“å¡'
                };
                checkinRecords.push(newRecord);
            } else {
                // æ›´æ–°ç°æœ‰è®°å½•
                if (type === 'morning') {
                    checkinRecords[recordIndex].morningStatus = 'æ‰“å¡';
                } else {
                    checkinRecords[recordIndex].afternoonStatus = 'æ‰“å¡';
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveRecords();
            
            // æ›´æ–°UI
            renderRecords();
            renderCalendar();
            
            showToast(type === 'morning' ? 'ä¸Šåˆæ‰“å¡æˆåŠŸ' : 'ä¸‹åˆæ‰“å¡æˆåŠŸ');
        }
        
        // ä¼‘ç­ç™»è®°
        function registerRest(type) {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»è®°ä¼‘ç­
            let recordIndex = checkinRecords.findIndex(record => record.date === dateStr);
            
            if (recordIndex === -1) {
                // æ–°å»ºè®°å½•
                const newRecord = {
                    id: Date.now(),
                    date: dateStr,
                    morningStatus: 'æœªæ‰“å¡',
                    afternoonStatus: 'æœªæ‰“å¡'
                };
                
                if (type === 'morning' || type === 'all') {
                    newRecord.morningStatus = 'ä¼‘ç­';
                }
                
                if (type === 'afternoon' || type === 'all') {
                    newRecord.afternoonStatus = 'ä¼‘ç­';
                }
                
                checkinRecords.push(newRecord);
            } else {
                // æ›´æ–°ç°æœ‰è®°å½•
                if (type === 'morning' || type === 'all') {
                    checkinRecords[recordIndex].morningStatus = 'ä¼‘ç­';
                }
                
                if (type === 'afternoon' || type === 'all') {
                    checkinRecords[recordIndex].afternoonStatus = 'ä¼‘ç­';
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveRecords();
            
            // æ›´æ–°UI
            renderRecords();
            renderCalendar();
            
            let message = '';
            if (type === 'morning') message = 'ä¸Šåˆä¼‘ç­ç™»è®°æˆåŠŸ';
            else if (type === 'afternoon') message = 'ä¸‹åˆä¼‘ç­ç™»è®°æˆåŠŸ';
            else message = 'å…¨å¤©ä¼‘ç­ç™»è®°æˆåŠŸ';
            
            showToast(message);
        }
        
        // ä¿å­˜è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
        function saveRecords() {
            localStorage.setItem('checkinRecords', JSON.stringify(checkinRecords));
        }
        
        // æ¸²æŸ“è®°å½•è¡¨æ ¼
        function renderRecords(filteredRecords = null) {
            const recordBody = document.getElementById('recordBody');
            const recordsToRender = filteredRecords || checkinRecords;
            
            if (recordsToRender.length === 0) {
                recordBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div class="empty-icon">ğŸ“„</div>
                            <div>æš‚æ— æ‰“å¡è®°å½•</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸé™åºæ’åº
            const sortedRecords = [...recordsToRender].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            recordBody.innerHTML = '';
            
            sortedRecords.forEach((record, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.date}</td>
                    <td>${record.morningStatus}</td>
                    <td>${record.afternoonStatus}</td>
                    <td>
                        <button onclick="selectRecord(${record.id})" style="border:none; background:none; color:#409eff; cursor:pointer;">é€‰æ‹©</button>
                    </td>
                `;
                recordBody.appendChild(tr);
            });
        }
        
        // ç­›é€‰è®°å½•
        function filterRecords() {
            const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchText) {
                renderRecords();
                return;
            }
            
            const filtered = checkinRecords.filter(record => 
                record.date.toLowerCase().includes(searchText) ||
                record.morningStatus.toLowerCase().includes(searchText) ||
                record.afternoonStatus.toLowerCase().includes(searchText)
            );
            
            renderRecords(filtered);
        }
        
        // é€‰æ‹©è®°å½•ï¼ˆç”¨äºç¼–è¾‘/åˆ é™¤ï¼‰
        function selectRecord(recordId) {
            selectedRecordId = recordId;
            showToast('å·²é€‰æ‹©è¯¥è®°å½•');
        }
        
        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(mode) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const recordForm = document.getElementById('recordForm');
            
            // é‡ç½®è¡¨å•
            recordForm.reset();
            
            // è®¾ç½®æ ‡é¢˜
            modalTitle.textContent = mode === 'add' ? 'æ·»åŠ è®°å½•' : 'ç¼–è¾‘è®°å½•';
            
            // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ä¸”æœ‰é€‰ä¸­çš„è®°å½•
            if (mode === 'edit' && selectedRecordId) {
                const record = checkinRecords.find(r => r.id === selectedRecordId);
                if (record) {
                    document.getElementById('recordDate').value = record.date;
                    document.getElementById('morningStatus').value = record.morningStatus;
                    document.getElementById('afternoonStatus').value = record.afternoonStatus;
                } else {
                    showToast('è¯·å…ˆé€‰æ‹©è¦ç¼–è¾‘çš„è®°å½•');
                    return;
                }
            }
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            modal.style.display = 'flex';
            
            // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
            recordForm.onsubmit = function(e) {
                e.preventDefault();
                
                const date = document.getElementById('recordDate').value;
                const morningStatus = document.getElementById('morningStatus').value;
                const afternoonStatus = document.getElementById('afternoonStatus').value;
                
                if (mode === 'add') {
                    // æ·»åŠ æ–°è®°å½•
                    const newRecord = {
                        id: Date.now(),
                        date,
                        morningStatus,
                        afternoonStatus
                    };
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥æ—¥æœŸçš„è®°å½•
                    const existingIndex = checkinRecords.findIndex(r => r.date === date);
                    if (existingIndex !== -1) {
                        checkinRecords[existingIndex] = {
                            ...checkinRecords[existingIndex],
                            morningStatus,
                            afternoonStatus
                        };
                    } else {
                        checkinRecords.push(newRecord);
                    }
                    
                    showToast('è®°å½•æ·»åŠ æˆåŠŸ');
                } else {
                    // ç¼–è¾‘ç°æœ‰è®°å½•
                    const recordIndex = checkinRecords.findIndex(r => r.id === selectedRecordId);
                    if (recordIndex !== -1) {
                        checkinRecords[recordIndex] = {
                            ...checkinRecords[recordIndex],
                            date,
                            morningStatus,
                            afternoonStatus
                        };
                        showToast('è®°å½•ç¼–è¾‘æˆåŠŸ');
                    }
                }
                
                // ä¿å­˜å¹¶æ›´æ–°UI
                saveRecords();
                renderRecords();
                renderCalendar();
                closeModal();
            };
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }
        
        // åˆ é™¤è®°å½•
        function deleteRecord() {
            if (!selectedRecordId) {
                showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„è®°å½•å—ï¼Ÿ')) {
                const recordIndex = checkinRecords.findIndex(r => r.id === selectedRecordId);
                if (recordIndex !== -1) {
                    checkinRecords.splice(recordIndex, 1);
                    saveRecords();
                    renderRecords();
                    renderCalendar();
                    selectedRecordId = null;
                    showToast('è®°å½•åˆ é™¤æˆåŠŸ');
                }
            }
        }
        
        // æ¸…é™¤æŒ‡å®šæœˆä»½è®°å½•
        function clearMonthRecords() {
            const month = prompt('è¯·è¾“å…¥è¦æ¸…é™¤è®°å½•çš„æœˆä»½ï¼ˆæ ¼å¼ï¼šYYYY-MMï¼‰ï¼š');
            if (!month) return;
            
            if (!/^\d{4}-\d{2}$/.test(month)) {
                showToast('æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥YYYY-MMæ ¼å¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…é™¤${month}çš„æ‰€æœ‰è®°å½•å—ï¼Ÿ`)) {
                const originalLength = checkinRecords.length;
                checkinRecords = checkinRecords.filter(record => 
                    !record.date.startsWith(month)
                );
                
                saveRecords();
                renderRecords();
                renderCalendar();
                
                const deletedCount = originalLength - checkinRecords.length;
                showToast(`å·²æ¸…é™¤${deletedCount}æ¡è®°å½•`);
            }
        }
        
        // å¯¼å‡ºè®°å½•ä¸ºExcel
        function exportRecords() {
            if (checkinRecords.length === 0) {
                showToast('æš‚æ— è®°å½•å¯å¯¼å‡º');
                return;
            }
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const exportData = checkinRecords.map((record, index) => ({
                åºå·: index + 1,
                æ—¥æœŸ: record.date,
                ä¸ŠåˆçŠ¶æ€: record.morningStatus,
                ä¸‹åˆçŠ¶æ€: record.afternoonStatus
            }));
            
            // åˆ›å»ºå·¥ä½œç°¿
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "è€ƒå‹¤è®°å½•");
            
            // å¯¼å‡ºæ–‡ä»¶
            const now = new Date();
            const fileName = `è€ƒå‹¤è®°å½•_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showToast('è®°å½•å¯¼å‡ºæˆåŠŸ');
        }
        
        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonthEl = document.getElementById('currentMonth');
            
            // è®¾ç½®å½“å‰æœˆä»½æ ‡é¢˜
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth() + 1;
            currentMonthEl.textContent = `${year}å¹´${month}æœˆ`;
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©
            const firstDay = new Date(year, currentCalendarMonth.getMonth(), 1);
            // è·å–å½“æœˆæœ€åä¸€å¤©
            const lastDay = new Date(year, currentCalendarMonth.getMonth() + 1, 0);
            // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡  (0-6, 0æ˜¯å‘¨æ—¥)
            const firstDayOfWeek = firstDay.getDay();
            
            // æ¸…ç©ºæ—¥å†
            calendarGrid.innerHTML = '';
            
            // æ·»åŠ å‰ç½®ç©ºç™½æ ¼å­
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day';
                calendarGrid.appendChild(emptyCell);
            }
            
            // æ·»åŠ æ—¥æœŸæ ¼å­
            const daysInMonth = lastDay.getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                // æŸ¥æ‰¾è¯¥æ—¥æœŸçš„è®°å½•
                const record = checkinRecords.find(r => r.date === dateStr);
                
                // åˆ›å»ºæ—¥æœŸæ ¼å­
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // æ—¥æœŸæ•°å­—
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // ä¸ŠåˆçŠ¶æ€
                const morningCell = document.createElement('div');
                morningCell.className = 'status-cell';
                
                if (record && record.morningStatus === 'æ‰“å¡') {
                    morningCell.classList.add('status-present');
                    morningCell.textContent = 'âˆš';
                } else if (record && record.morningStatus === 'ä¼‘ç­') {
                    morningCell.classList.add('status-rest');
                    morningCell.textContent = 'ä¼‘';
                } else {
                    morningCell.classList.add('status-absent');
                    morningCell.textContent = 'Ã—';
                }
                
                dayCell.appendChild(morningCell);
                
                // ä¸‹åˆçŠ¶æ€
                const afternoonCell = document.createElement('div');
                afternoonCell.className = 'status-cell';
                
                if (record && record.afternoonStatus === 'æ‰“å¡') {
                    afternoonCell.classList.add('status-present');
                    afternoonCell.textContent = 'âˆš';
                } else if (record && record.afternoonStatus === 'ä¼‘ç­') {
                    afternoonCell.classList.add('status-rest');
                    afternoonCell.textContent = 'ä¼‘';
                } else {
                    afternoonCell.classList.add('status-absent');
                    afternoonCell.textContent = 'Ã—';
                }
                
                dayCell.appendChild(afternoonCell);
                
                calendarGrid.appendChild(dayCell);
            }
        }
        
        // åˆ‡æ¢æœˆä»½
        function changeMonth(direction) {
            currentCalendarMonth = new Date(
                currentCalendarMonth.getFullYear(),
                currentCalendarMonth.getMonth() + direction,
                1
            );
            renderCalendar();
        }
        
        // åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–å½“å‰æ—¥å†æœˆä»½ä¸ºä»Šå¤©
            currentCalendarMonth = new Date();
            // æ¸²æŸ“è®°å½•
            renderRecords();
            // æ¸²æŸ“æ—¥å†
            renderCalendar();
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            const modal = document.getElementById('modal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        };
    </script>
</body>
</html>