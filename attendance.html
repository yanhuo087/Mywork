<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯è€ƒå‹¤æ‰“å¡ç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* é¡µé¢å®¹å™¨ */
        .container {
            max-width: 750px;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .tab-nav {
            display: flex;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn.active {
            color: #409eff;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #409eff;
            border-radius: 3px;
        }
        
        /* é¡µé¢å†…å®¹åŒºåŸŸ */
        .page {
            display: none;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            min-height: calc(100vh - 100px);
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç¬¬ä¸€é¡µï¼šæ‰“å¡ç™»è®°æ–°æ ·å¼ */
        .text-2xl {
            font-size: 20px;
        }
        
        .font-bold {
            font-weight: 600;
        }
        
        .mb-6 {
            margin-bottom: 15px;
        }
        
        .text-xl {
            font-size: 18px;
        }
        
        .font-semibold {
            font-weight: 500;
        }
        
        .mb-4 {
            margin-bottom: 10px;
        }
        
        .text-gray-600 {
            color: #666;
            font-size: 14px;
        }
        
        .mb-2 {
            margin-bottom: 5px;
        }
        
        .mt-8 {
            margin-top: 20px;
        }
        
        .p-4 {
            padding: 10px;
        }
        
        .border {
            border: 1px solid #eee;
        }
        
        .rounded-lg {
            border-radius: 8px;
        }
        
        .bg-gray-50 {
            background-color: #f8f9fa;
        }
        
        .checkin-section {
            display: flex;
            flex-direction: row; /* æ”¹ä¸ºæ¨ªå‘æ’åˆ— */
            flex-wrap: wrap; /* å…è®¸åœ¨å°å±å¹•æ¢è¡Œ */
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .checkin-card {
            flex: 1;
            min-width: calc(50% - 5px); /* ç¡®ä¿åœ¨å°å±å¹•èƒ½å¹¶æ’æ˜¾ç¤º */
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }
        
        /* ä¼‘ç­ç™»è®°å¡ç‰‡ - å æ»¡æ•´è¡Œ */
        .checkin-card:last-child {
            flex-basis: 100%; /* ä¼‘ç­å¡ç‰‡å æ»¡æ•´è¡Œ */
        }

        /* é€‚é…æ›´å°çš„å±å¹• */
        @media (max-width: 320px) {
            .checkin-card {
                min-width: 100%; /* åœ¨æå°å±å¹•ä¸‹æ”¹ä¸ºå‚ç›´æ’åˆ— */
            }
        }

        .checkin-btn {
            width: 100%;
            height: 45px;
            margin-top: 10px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #morning-checkin {
            background-color: #0b3de0;
        }
        
        #afternoon-checkin {
            background-color: #0b3de0;
        }
        
        .rest-btns {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .rest-btn {
            flex: 1;
            height: 45px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        #morning-rest {
            background-color: #e0641c;
        }
        
        #afternoon-rest {
            background-color: #e72d0c;
        }
        
        #all-day-rest {
            background-color: #dd2121;
        }
        
        #today-summary {
            font-size: 14px;
            color: #333;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            text-align: left;
            gap: 5px;
        }
        
        /* ç¬¬äºŒé¡µï¼šè®°å½•ç®¡ç†æ ·å¼ */
        .record-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            height: 45px;
            padding: 0 15px 0 40px;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .search-input:focus {
            border-color: #409eff;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 18px;
        }
        
        .record-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .action-btn {
            height: 40px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .add-btn { background-color: #67c23a; }
        .edit-btn { background-color: #409eff; }
        .delete-btn { background-color: #f56c6c; }
        .clear-btn { background-color: #e6a23c; }
        .export-btn { background-color: #722ed1; }
        
        .record-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .record-table th,
        .record-table td {
            padding: 12px 8px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .record-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #666;
        }
        
        .record-table tr:last-child td {
            border-bottom: none;
        }
        
        .record-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .record-table tr.selected {
            background-color: #e6f7ff;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        /* ç¬¬ä¸‰é¡µï¼šå›¾å½¢åŒ–å±•ç¤ºæ ·å¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background-color: #409eff;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .month-btn:active {
            transform: scale(0.95);
        }
        
        .current-month {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-header-cell {
            text-align: center;
            padding: 10px 0;
            font-weight: 600;
            color: #666;
            font-size: 14px;
        }
        
        .calendar-day {
            height: 60px; /* å¢åŠ é«˜åº¦ä»¥å®¹çº³ä¸¤è¡ŒçŠ¶æ€ */
            border: 1px solid #eee;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .day-number {
            padding: 3px;
            font-size: 12px;
            text-align: center;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .status-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .status-cell {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .status-present {
            background-color: #67c23a;
        }
        
        .status-absent {
            background-color: #f56c6c;
        }
        
        .status-rest {
            background-color: #409eff;
        }
        
        .status-label {
            font-size: 8px;
            padding: 1px 0;
            background-color: rgba(0,0,0,0.1);
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: #fff;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            animation: modalFade 0.3s ease;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-label {
            font-size: 14px;
            color: #666;
        }
        
        .form-input, .form-select, .form-textarea {
            height: 40px;
            padding: 0 15px;
            border-radius: 8px;
            border: 1px solid #e5e5e5;
            font-size: 16px;
            outline: none;
        }
        
        .form-textarea {
            height: 80px;
            padding: 15px;
            resize: none;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #409eff;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            height: 45px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .confirm-btn {
            background-color: #409eff;
            color: #fff;
        }
        
        .cancel-btn {
            background-color: #f5f7fa;
            color: #666;
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
            color: #999;
            font-size: 16px;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* æç¤ºæ¡†æ ·å¼ */
        .success-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            display: none;
            z-index: 9999;
        }
        
        /* é€‚é…å°å±æ‰‹æœº */
        @media (max-width: 375px) {
            .checkin-card {
                padding: 12px;
            }
            
            .text-2xl {
                font-size: 18px;
            }
            
            .text-xl {
                font-size: 16px;
            }
            
            .checkin-btn, .rest-btn {
                height: 40px;
                font-size: 14px;
            }
            
            .record-table th,
            .record-table td {
                padding: 10px 5px;
                font-size: 12px;
            }
            
            .calendar-day {
                height: 80px;
            }
            
            .status-cell {
                font-size: 10px;
            }
            
            .day-number {
                font-size: 10px;
                padding: 2px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡ç­¾å¯¼èˆª -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchPage(0)">æ‰“å¡ç™»è®°</button>
            <button class="tab-btn" onclick="switchPage(1)">è®°å½•ç®¡ç†</button>
            <button class="tab-btn" onclick="switchPage(2)">æ‰“å¡æ—¥å†</button>
        </div>
        
        <!-- ç¬¬ä¸€é¡µï¼šæ‰“å¡ç™»è®° -->
        <div class="page active" id="page1">
            <h2 class="text-2xl font-bold mb-6">è€ƒå‹¤æ‰“å¡ç™»è®°</h2>
            
            <div class="checkin-section">
                <!-- ä¸Šåˆæ‰“å¡ -->
                <div class="checkin-card">
                    <h3 class="text-xl font-semibold mb-4">ä¸Šåˆæ‰“å¡</h3>
                    <p class="text-gray-600 mb-2" id="morning-time">å½“å‰æ—¶é—´: <span id="current-morning-time"></span></p>
                    <p class="text-gray-600" id="morning-status">çŠ¶æ€: æœªæ‰“å¡</p>
                    <button class="checkin-btn" id="morning-checkin" onclick="checkin('morning')">ä¸Šåˆæ‰“å¡</button>
                </div>

                <!-- ä¸‹åˆæ‰“å¡ -->
                <div class="checkin-card">
                    <h3 class="text-xl font-semibold mb-4">ä¸‹åˆæ‰“å¡</h3>
                    <p class="text-gray-600 mb-2" id="afternoon-time">å½“å‰æ—¶é—´: <span id="current-afternoon-time"></span></p>
                    <p class="text-gray-600" id="afternoon-status">çŠ¶æ€: æœªæ‰“å¡</p>
                    <button class="checkin-btn" id="afternoon-checkin" onclick="checkin('afternoon')">ä¸‹åˆæ‰“å¡</button>
                </div>

                <!-- ä¼‘ç­ç™»è®° -->
                <div class="checkin-card">
                    <h3 class="text-xl font-semibold mb-4">ä¼‘ç­ç™»è®°</h3>
                    <p class="text-gray-600 mb-2" id="rest-date">ç™»è®°æ—¥æœŸ: <span id="current-rest-date"></span></p>
                    <p class="text-gray-600 mb-4" id="rest-status">çŠ¶æ€: æ­£å¸¸ä¸Šç­</p>
                    <div class="rest-btns">
                        <button class="rest-btn" id="morning-rest" onclick="registerRest('morning')">ä¸Šåˆä¼‘ç­</button>
                        <button class="rest-btn" id="afternoon-rest" onclick="registerRest('afternoon')">ä¸‹åˆä¼‘ç­</button>
                        <button class="rest-btn" id="all-day-rest" onclick="registerRest('all')">å…¨å¤©ä¼‘ç­</button>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4">ä»Šæ—¥æ‰“å¡ä¿¡æ¯</h3>
                <div id="today-summary" class="p-4 border rounded-lg bg-gray-50">
                    ç­‰å¾…æ‰“å¡æ“ä½œ...
                </div>
            </div>
        </div>
        
        <!-- ç¬¬äºŒé¡µï¼šè®°å½•ç®¡ç† -->
        <div class="page" id="page2">
            <div class="record-controls">
                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢è®°å½•ï¼ˆæ—¥æœŸ/çŠ¶æ€ï¼‰" oninput="filterRecords()">
                </div>
                
                <div class="record-actions">
                    <button class="action-btn add-btn" onclick="openModal('add')">æ·»åŠ è®°å½•</button>
                    <button class="action-btn edit-btn" onclick="openModal('edit')">ç¼–è¾‘è®°å½•</button>
                    <button class="action-btn delete-btn" onclick="deleteRecord()">åˆ é™¤è®°å½•</button>
                    <button class="action-btn clear-btn" onclick="clearMonthRecords()">æ¸…é™¤æœˆåº¦è®°å½•</button>
                    <button class="action-btn export-btn" onclick="exportRecords()">å¯¼å‡ºExcel</button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="record-table" id="recordTable">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>æ—¥æœŸ</th>
                            <th>ä¸ŠåˆçŠ¶æ€</th>
                            <th>ä¸‹åˆçŠ¶æ€</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="recordBody">
                        <!-- è®°å½•å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ç¬¬ä¸‰é¡µï¼šå›¾å½¢åŒ–å±•ç¤º -->
        <div class="page" id="page3">
            <div class="calendar-header">
                <button class="month-btn" onclick="changeMonth(-1)">â—€</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-btn" onclick="changeMonth(1)">â–¶</button>
            </div>
            
            <div class="calendar-grid">
                <div class="calendar-header-cell">æ—¥</div>
                <div class="calendar-header-cell">ä¸€</div>
                <div class="calendar-header-cell">äºŒ</div>
                <div class="calendar-header-cell">ä¸‰</div>
                <div class="calendar-header-cell">å››</div>
                <div class="calendar-header-cell">äº”</div>
                <div class="calendar-header-cell">å…­</div>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- æ—¥æœŸæ ¼å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æˆåŠŸæç¤ºæ¡† -->
        <div class="success-toast" id="toast"></div>
        
        <!-- æ¨¡æ€æ¡† -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h3 class="modal-title" id="modalTitle">æ·»åŠ è®°å½•</h3>
                <form class="modal-form" id="recordForm">
                    <div class="form-group">
                        <label class="form-label">æ—¥æœŸ</label>
                        <input type="date" class="form-input" id="recordDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸ŠåˆçŠ¶æ€</label>
                        <select class="form-select" id="morningStatus">
                            <option value="æ‰“å¡">æ‰“å¡</option>
                            <option value="æœªæ‰“å¡">æœªæ‰“å¡</option>
                            <option value="ä¼‘ç­">ä¼‘ç­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸‹åˆçŠ¶æ€</label>
                        <select class="form-select" id="afternoonStatus">
                            <option value="æ‰“å¡">æ‰“å¡</option>
                            <option value="æœªæ‰“å¡">æœªæ‰“å¡</option>
                            <option value="ä¼‘ç­">ä¼‘ç­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¤‡æ³¨</label>
                        <textarea class="form-textarea" id="recordNote" placeholder="å¯é€‰"></textarea>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
                        <button type="submit" class="modal-btn confirm-btn">ç¡®è®¤</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPage = 0;
        let checkinRecords = JSON.parse(localStorage.getItem('checkinRecords')) || [];
        let currentCalendarMonth = new Date();
        let selectedRecordId = null;
        let timeUpdateInterval;
        let currentModalMode = 'add'; // 'add' æˆ– 'edit'
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('recordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveRecord();
            });
            
            // åˆå§‹é¡µé¢è®¾ç½®
            startTimeUpdate();
            updateTodayStatus();
            renderRecords();
            renderCalendar();
        });
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageIndex) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach((page, index) => {
                page.classList.toggle('active', index === pageIndex);
            });
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index === pageIndex);
            });
            
            currentPage = pageIndex;
            
            // å¦‚æœåˆ‡æ¢åˆ°æ—¥å†é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“æ—¥å†
            if (pageIndex === 2) {
                renderCalendar();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°è®°å½•é¡µé¢ï¼Œé‡æ–°æ¸²æŸ“è®°å½•
            if (pageIndex === 1) {
                renderRecords();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°æ‰“å¡é¡µé¢ï¼Œå¯åŠ¨æ—¶é—´æ›´æ–°å¹¶åˆ·æ–°çŠ¶æ€
            if (pageIndex === 0) {
                startTimeUpdate();
                updateTodayStatus();
            } else {
                stopTimeUpdate();
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const now = new Date();
            const timeStr = now.toTimeString().split(' ')[0];
            
            document.getElementById('current-morning-time').textContent = timeStr;
            document.getElementById('current-afternoon-time').textContent = timeStr;
            
            // æ›´æ–°ä¼‘ç­ç™»è®°æ—¥æœŸ
            const dateStr = now.toISOString().split('T')[0];
            document.getElementById('current-rest-date').textContent = dateStr;
            
            // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡çŠ¶æ€ï¼Œç¡®ä¿çŠ¶æ€æ­£ç¡®
            if (now.getSeconds() === 0) {
                updateTodayStatus();
            }
        }
        
        // å¯åŠ¨æ—¶é—´æ›´æ–°
        function startTimeUpdate() {
            updateTimeDisplay();
            if (!timeUpdateInterval) {
                timeUpdateInterval = setInterval(updateTimeDisplay, 1000);
            }
        }
        
        // åœæ­¢æ—¶é—´æ›´æ–°
        function stopTimeUpdate() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
                timeUpdateInterval = null;
            }
        }
        
        // æ›´æ–°ä»Šæ—¥çŠ¶æ€æ˜¾ç¤º
        function updateTodayStatus() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            
            // æŸ¥æ‰¾ä»Šå¤©çš„è®°å½•
            const todayRecord = checkinRecords.find(record => record.date === dateStr);
            
            // æ›´æ–°ä¸ŠåˆçŠ¶æ€
            const morningStatusEl = document.getElementById('morning-status');
            if (todayRecord && todayRecord.morningStatus === 'æ‰“å¡') {
                morningStatusEl.textContent = 'çŠ¶æ€: å·²æ‰“å¡';
                morningStatusEl.style.color = '#67c23a';
                document.getElementById('morning-checkin').disabled = true;
                document.getElementById('morning-checkin').style.opacity = '0.7';
            } else if (todayRecord && todayRecord.morningStatus === 'ä¼‘ç­') {
                morningStatusEl.textContent = 'çŠ¶æ€: ä¼‘ç­';
                morningStatusEl.style.color = '#409eff';
                document.getElementById('morning-checkin').disabled = true;
                document.getElementById('morning-checkin').style.opacity = '0.7';
            } else {
                morningStatusEl.textContent = 'çŠ¶æ€: æœªæ‰“å¡';
                morningStatusEl.style.color = '#666';
                document.getElementById('morning-checkin').disabled = false;
                document.getElementById('morning-checkin').style.opacity = '1';
            }
            
            // æ›´æ–°ä¸‹åˆçŠ¶æ€
            const afternoonStatusEl = document.getElementById('afternoon-status');
            if (todayRecord && todayRecord.afternoonStatus === 'æ‰“å¡') {
                afternoonStatusEl.textContent = 'çŠ¶æ€: å·²æ‰“å¡';
                afternoonStatusEl.style.color = '#67c23a';
                document.getElementById('afternoon-checkin').disabled = true;
                document.getElementById('afternoon-checkin').style.opacity = '0.7';
            } else if (todayRecord && todayRecord.afternoonStatus === 'ä¼‘ç­') {
                afternoonStatusEl.textContent = 'çŠ¶æ€: ä¼‘ç­';
                afternoonStatusEl.style.color = '#409eff';
                document.getElementById('afternoon-checkin').disabled = true;
                document.getElementById('afternoon-checkin').style.opacity = '0.7';
            } else {
                afternoonStatusEl.textContent = 'çŠ¶æ€: æœªæ‰“å¡';
                afternoonStatusEl.style.color = '#666';
                document.getElementById('afternoon-checkin').disabled = false;
                document.getElementById('afternoon-checkin').style.opacity = '1';
            }
            
            // æ›´æ–°ä¼‘ç­çŠ¶æ€
            const restStatusEl = document.getElementById('rest-status');
            if (todayRecord && todayRecord.morningStatus === 'ä¼‘ç­' && todayRecord.afternoonStatus === 'ä¼‘ç­') {
                restStatusEl.textContent = 'çŠ¶æ€: å…¨å¤©ä¼‘ç­';
                restStatusEl.style.color = '#722ed1';
                document.querySelectorAll('.rest-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.7';
                });
            } else if (todayRecord && todayRecord.morningStatus === 'ä¼‘ç­') {
                restStatusEl.textContent = 'çŠ¶æ€: ä¸Šåˆä¼‘ç­';
                restStatusEl.style.color = '#e6a23c';
                document.getElementById('morning-rest').disabled = true;
                document.getElementById('morning-rest').style.opacity = '0.7';
            } else if (todayRecord && todayRecord.afternoonStatus === 'ä¼‘ç­') {
                restStatusEl.textContent = 'çŠ¶æ€: ä¸‹åˆä¼‘ç­';
                restStatusEl.style.color = '#f56c6c';
                document.getElementById('afternoon-rest').disabled = true;
                document.getElementById('afternoon-rest').style.opacity = '0.7';
            } else {
                restStatusEl.textContent = 'çŠ¶æ€: æ­£å¸¸ä¸Šç­';
                restStatusEl.style.color = '#67c23a';
                document.querySelectorAll('.rest-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                });
            }
            
            // æ›´æ–°ä»Šæ—¥æ±‡æ€»ä¿¡æ¯
            updateTodaySummary();
        }
        
        // æ›´æ–°ä»Šæ—¥æ±‡æ€»ä¿¡æ¯
        function updateTodaySummary() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const todayRecord = checkinRecords.find(r => r.date === today);
            
            const summaryEl = document.getElementById('today-summary');
            
            // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤ºï¼ˆåŒ…å«æ˜ŸæœŸï¼‰
            const formattedDate = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            if (!todayRecord) {
                // æ— æ‰“å¡è®°å½•çš„æƒ…å†µ
                summaryEl.innerHTML = `
                    <div>ğŸ“… ä»Šæ—¥æ—¥æœŸ: ${formattedDate}</div>
                    <div>ğŸŒ ä¸ŠåˆçŠ¶æ€: âŒ æœªæ‰“å¡</div>
                    <div>ğŸŒ™ ä¸‹åˆçŠ¶æ€: âŒ æœªæ‰“å¡</div>
                    <div>ğŸ·ï¸ å¤‡æ³¨: æš‚æ— æ‰“å¡è®°å½•</div>
                `;
                return;
            }
            
            // çŠ¶æ€æ–‡æœ¬æ˜ å°„
            const statusText = {
                'æ‰“å¡': 'âœ… å·²æ‰“å¡',
                'æœªæ‰“å¡': 'âŒ æœªæ‰“å¡',
                'ä¼‘ç­': 'ğŸ›Œ ä¼‘ç­'
            };
            
            // æ„å»ºå¤‡æ³¨ä¿¡æ¯
            let noteText = todayRecord.note || 'æ— ';
            
            // ç‰¹æ®Šå¤„ç†ä¼‘ç­æƒ…å†µçš„å¤‡æ³¨
            if (todayRecord.morningStatus === 'ä¼‘ç­' && todayRecord.afternoonStatus === 'ä¼‘ç­' && !todayRecord.note) {
                noteText = 'å…¨å¤©ä¼‘ç­';
            } else if (todayRecord.morningStatus === 'ä¼‘ç­' && !todayRecord.note) {
                noteText = 'ä¸Šåˆä¼‘ç­';
            } else if (todayRecord.afternoonStatus === 'ä¼‘ç­' && !todayRecord.note) {
                noteText = 'ä¸‹åˆä¼‘ç­';
            }
            
            // æ›´æ–°æ±‡æ€»ä¿¡æ¯HTML
            summaryEl.innerHTML = `
                <div>ğŸ“… ä»Šæ—¥æ—¥æœŸ: ${formattedDate}</div>
                <div>ğŸŒ ä¸ŠåˆçŠ¶æ€: ${statusText[todayRecord.morningStatus]}</div>
                <div>ğŸŒ™ ä¸‹åˆçŠ¶æ€: ${statusText[todayRecord.afternoonStatus]}</div>
                <div>ğŸ·ï¸ å¤‡æ³¨: ${noteText}</div>
            `;
        }
        
        // æ‰“å¡åŠŸèƒ½
        function checkin(type) {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const timeStr = now.toTimeString().split(' ')[0].substring(0, 8);
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ‰“å¡
            const existingRecord = checkinRecords.find(record => 
                record.date === dateStr && 
                ((type === 'morning' && record.morningStatus === 'æ‰“å¡') || 
                 (type === 'afternoon' && record.afternoonStatus === 'æ‰“å¡'))
            );
            
            if (existingRecord) {
                showToast(type === 'morning' ? 'ä¸Šåˆå·²æ‰“å¡' : 'ä¸‹åˆå·²æ‰“å¡');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»è®°ä¼‘ç­
            const restRecord = checkinRecords.find(record => 
                record.date === dateStr && 
                ((type === 'morning' && record.morningStatus === 'ä¼‘ç­') || 
                 (type === 'afternoon' && record.afternoonStatus === 'ä¼‘ç­'))
            );
            
            if (restRecord) {
                showToast(type === 'morning' ? 'å·²ç™»è®°ä¸Šåˆä¼‘ç­ï¼Œä¸èƒ½æ‰“å¡' : 'å·²ç™»è®°ä¸‹åˆä¼‘ç­ï¼Œä¸èƒ½æ‰“å¡');
                return;
            }
            
            // æ›´æ–°æˆ–æ·»åŠ è®°å½•
            let recordIndex = checkinRecords.findIndex(record => record.date === dateStr);
            
            if (recordIndex === -1) {
                // æ–°å»ºè®°å½•
                const newRecord = {
                    id: Date.now(),
                    date: dateStr,
                    morningStatus: type === 'morning' ? 'æ‰“å¡' : 'æœªæ‰“å¡',
                    afternoonStatus: type === 'afternoon' ? 'æ‰“å¡' : 'æœªæ‰“å¡',
                    note: ''
                };
                checkinRecords.push(newRecord);
            } else {
                // æ›´æ–°ç°æœ‰è®°å½•
                if (type === 'morning') {
                    checkinRecords[recordIndex].morningStatus = 'æ‰“å¡';
                } else {
                    checkinRecords[recordIndex].afternoonStatus = 'æ‰“å¡';
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveRecords();
            
            // æ›´æ–°UI
            renderRecords();
            renderCalendar();
            updateTodayStatus();
            
            showToast(type === 'morning' ? 'ä¸Šåˆæ‰“å¡æˆåŠŸ' : 'ä¸‹åˆæ‰“å¡æˆåŠŸ');
        }
        
        // ä¼‘ç­ç™»è®°
        function registerRest(type) {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ‰“å¡
            const existingRecord = checkinRecords.find(record => record.date === dateStr);
            
            if (existingRecord) {
                if ((type === 'morning' || type === 'all') && existingRecord.morningStatus === 'æ‰“å¡') {
                    showToast('ä¸Šåˆå·²æ‰“å¡ï¼Œä¸èƒ½ç™»è®°ä¼‘ç­');
                    return;
                }
                if ((type === 'afternoon' || type === 'all') && existingRecord.afternoonStatus === 'æ‰“å¡') {
                    showToast('ä¸‹åˆå·²æ‰“å¡ï¼Œä¸èƒ½ç™»è®°ä¼‘ç­');
                    return;
                }
            }
            
            // æ›´æ–°æˆ–æ·»åŠ è®°å½•
            let recordIndex = checkinRecords.findIndex(record => record.date === dateStr);
            
            if (recordIndex === -1) {
                // æ–°å»ºè®°å½•
                const newRecord = {
                    id: Date.now(),
                    date: dateStr,
                    morningStatus: 'æœªæ‰“å¡',
                    afternoonStatus: 'æœªæ‰“å¡',
                    note: ''
                };
                
                if (type === 'morning' || type === 'all') {
                    newRecord.morningStatus = 'ä¼‘ç­';
                }
                
                if (type === 'afternoon' || type === 'all') {
                    newRecord.afternoonStatus = 'ä¼‘ç­';
                }
                
                checkinRecords.push(newRecord);
            } else {
                // æ›´æ–°ç°æœ‰è®°å½•
                if (type === 'morning' || type === 'all') {
                    checkinRecords[recordIndex].morningStatus = 'ä¼‘ç­';
                }
                
                if (type === 'afternoon' || type === 'all') {
                    checkinRecords[recordIndex].afternoonStatus = 'ä¼‘ç­';
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveRecords();
            
            // æ›´æ–°UI
            renderRecords();
            renderCalendar();
            updateTodayStatus();
            
            let message = '';
            if (type === 'morning') {
                message = 'ä¸Šåˆä¼‘ç­ç™»è®°æˆåŠŸ';
            } else if (type === 'afternoon') {
                message = 'ä¸‹åˆä¼‘ç­ç™»è®°æˆåŠŸ';
            } else {
                message = 'å…¨å¤©ä¼‘ç­ç™»è®°æˆåŠŸ';
            }
            showToast(message);
        }
        
        // ä¿å­˜è®°å½•åˆ°æœ¬åœ°å­˜å‚¨
        function saveRecords() {
            localStorage.setItem('checkinRecords', JSON.stringify(checkinRecords));
        }
        
        // æ¸²æŸ“è®°å½•åˆ—è¡¨
        function renderRecords() {
            const recordBody = document.getElementById('recordBody');
            recordBody.innerHTML = '';
            
            // æŒ‰æ—¥æœŸå€’åºæ’åº
            const sortedRecords = [...checkinRecords].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            if (sortedRecords.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = '<td colspan="5" style="padding: 20px;">æš‚æ— æ‰“å¡è®°å½•</td>';
                recordBody.appendChild(emptyRow);
                return;
            }
            
            sortedRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.dataset.id = record.id;
                
                // ç‚¹å‡»è¡Œé€‰ä¸­è®°å½•
                row.addEventListener('click', function() {
                    document.querySelectorAll('#recordBody tr').forEach(r => 
                        r.classList.remove('selected')
                    );
                    this.classList.add('selected');
                    selectedRecordId = record.id;
                });
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${formatDate(record.date)}</td>
                    <td><span style="color: ${getStatusColor(record.morningStatus)}">${record.morningStatus}</span></td>
                    <td><span style="color: ${getStatusColor(record.afternoonStatus)}">${record.afternoonStatus}</span></td>
                    <td>
                        <button style="background: none; border: none; color: #409eff; cursor: pointer;" 
                                onclick="event.stopPropagation(); openModal('edit', ${record.id})">ç¼–è¾‘</button>
                        <button style="background: none; border: none; color: #f56c6c; cursor: pointer;" 
                                onclick="event.stopPropagation(); deleteRecord(${record.id})">åˆ é™¤</button>
                    </td>
                `;
                
                recordBody.appendChild(row);
            });
        }
        
        // è·å–çŠ¶æ€å¯¹åº”çš„é¢œè‰²
        function getStatusColor(status) {
            switch(status) {
                case 'æ‰“å¡': return '#67c23a';
                case 'ä¼‘ç­': return '#409eff';
                case 'æœªæ‰“å¡': return '#f56c6c';
                default: return '#333';
            }
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-CN');
        }
        
        // è¿‡æ»¤è®°å½•
        function filterRecords() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#recordBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // æ‰“å¼€æ¨¡æ€æ¡†
        function openModal(mode, id = null) {
            currentModalMode = mode;
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            
            // é‡ç½®è¡¨å•
            document.getElementById('recordForm').reset();
            
            if (mode === 'add') {
                modalTitle.textContent = 'æ·»åŠ è®°å½•';
                // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('recordDate').value = today;
                selectedRecordId = null;
            } else if (mode === 'edit') {
                modalTitle.textContent = 'ç¼–è¾‘è®°å½•';
                
                // å¦‚æœé€šè¿‡IDæŒ‡å®šäº†è®°å½•ï¼Œä½¿ç”¨è¯¥è®°å½•
                if (id) {
                    selectedRecordId = id;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„è®°å½•
                if (!selectedRecordId) {
                    showToast('è¯·å…ˆé€‰æ‹©ä¸€æ¡è®°å½•');
                    return;
                }
                
                // å¡«å……è¡¨å•æ•°æ®
                const record = checkinRecords.find(r => r.id === selectedRecordId);
                if (record) {
                    document.getElementById('recordDate').value = record.date;
                    document.getElementById('morningStatus').value = record.morningStatus;
                    document.getElementById('afternoonStatus').value = record.afternoonStatus;
                    document.getElementById('recordNote').value = record.note || '';
                }
            }
            
            modal.style.display = 'flex';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }
        
        // ä¿å­˜è®°å½•ï¼ˆæ·»åŠ æˆ–ç¼–è¾‘ï¼‰
        function saveRecord() {
            const date = document.getElementById('recordDate').value;
            const morningStatus = document.getElementById('morningStatus').value;
            const afternoonStatus = document.getElementById('afternoonStatus').value;
            const note = document.getElementById('recordNote').value;
            
            if (!date) {
                showToast('è¯·é€‰æ‹©æ—¥æœŸ');
                return;
            }
            
            if (currentModalMode === 'add') {
                // æ£€æŸ¥è¯¥æ—¥æœŸæ˜¯å¦å·²æœ‰è®°å½•
                const existingRecord = checkinRecords.find(r => r.date === date);
                if (existingRecord) {
                    showToast('è¯¥æ—¥æœŸå·²æœ‰è®°å½•ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¥æœŸæˆ–ç¼–è¾‘ç°æœ‰è®°å½•');
                    return;
                }
                
                // æ·»åŠ æ–°è®°å½•
                const newRecord = {
                    id: Date.now(),
                    date,
                    morningStatus,
                    afternoonStatus,
                    note
                };
                
                checkinRecords.push(newRecord);
                showToast('è®°å½•æ·»åŠ æˆåŠŸ');
            } else {
                // ç¼–è¾‘ç°æœ‰è®°å½•
                const recordIndex = checkinRecords.findIndex(r => r.id === selectedRecordId);
                if (recordIndex !== -1) {
                    checkinRecords[recordIndex].date = date;
                    checkinRecords[recordIndex].morningStatus = morningStatus;
                    checkinRecords[recordIndex].afternoonStatus = afternoonStatus;
                    checkinRecords[recordIndex].note = note;
                    showToast('è®°å½•æ›´æ–°æˆåŠŸ');
                }
            }
            
            // ä¿å­˜å¹¶æ›´æ–°UI
            saveRecords();
            renderRecords();
            renderCalendar();
            updateTodayStatus();
            closeModal();
        }
        
        // åˆ é™¤è®°å½•
        function deleteRecord(id = null) {
            // å¦‚æœé€šè¿‡IDæŒ‡å®šäº†è®°å½•ï¼Œä½¿ç”¨è¯¥è®°å½•
            if (id) {
                selectedRecordId = id;
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„è®°å½•
            if (!selectedRecordId) {
                showToast('è¯·å…ˆé€‰æ‹©ä¸€æ¡è®°å½•');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                checkinRecords = checkinRecords.filter(record => record.id !== selectedRecordId);
                selectedRecordId = null;
                
                // ä¿å­˜å¹¶æ›´æ–°UI
                saveRecords();
                renderRecords();
                renderCalendar();
                updateTodayStatus();
                showToast('è®°å½•å·²åˆ é™¤');
            }
        }
        
        // æ¸…é™¤æœˆåº¦è®°å½•
        function clearMonthRecords() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // ç¡®è®¤å¯¹è¯æ¡†
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${currentYear}å¹´${currentMonth + 1}æœˆ çš„æ‰€æœ‰è®°å½•å—ï¼Ÿ`)) {
                checkinRecords = checkinRecords.filter(record => {
                    const recordDate = new Date(record.date);
                    return !(recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear);
                });
                
                // ä¿å­˜å¹¶æ›´æ–°UI
                saveRecords();
                renderRecords();
                renderCalendar();
                updateTodayStatus();
                showToast('æœˆåº¦è®°å½•å·²æ¸…é™¤');
            }
        }
        
        // å¯¼å‡ºExcel
        function exportRecords() {
            if (checkinRecords.length === 0) {
                showToast('æ²¡æœ‰è®°å½•å¯å¯¼å‡º');
                return;
            }
            
            // å‡†å¤‡å¯¼å‡ºæ•°æ®
            const exportData = checkinRecords.map(record => {
                return {
                    'åºå·': checkinRecords.indexOf(record) + 1,
                    'æ—¥æœŸ': formatDate(record.date),
                    'ä¸ŠåˆçŠ¶æ€': record.morningStatus,
                    'ä¸‹åˆçŠ¶æ€': record.afternoonStatus,
                    'å¤‡æ³¨': record.note || ''
                };
            });
            
            // åˆ›å»ºå·¥ä½œç°¿å’Œå·¥ä½œè¡¨
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "è€ƒå‹¤è®°å½•");
            
            // è·å–å½“å‰å¹´æœˆä½œä¸ºæ–‡ä»¶å
            const now = new Date();
            const fileName = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆè€ƒå‹¤è®°å½•.xlsx`;
            
            // å¯¼å‡ºæ–‡ä»¶
            XLSX.writeFile(wb, fileName);
            showToast('å¯¼å‡ºæˆåŠŸ');
        }
        
        // æ¸²æŸ“æ—¥å†
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth();
            
            // æ›´æ–°å½“å‰æœˆä»½æ˜¾ç¤º
            document.getElementById('currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
            
            // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡  (0-6, 0æ˜¯æ˜ŸæœŸæ—¥)
            const firstDay = new Date(year, month, 1).getDay();
            
            // è·å–å½“æœˆçš„å¤©æ•°
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // æ·»åŠ ç©ºç™½æ ¼å­ï¼ˆä¸Šä¸ªæœˆçš„æ—¥æœŸä½ç½®ï¼‰
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.visibility = 'hidden'; // éšè—ä½†ä¿ç•™ä½ç½®
                calendarGrid.appendChild(emptyDay);
            }
            
            // æ·»åŠ å½“æœˆçš„æ—¥æœŸæ ¼å­
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const record = checkinRecords.find(r => r.date === dateStr);
                
                // é»˜è®¤çŠ¶æ€
                let morningStatus = 'æœªæ‰“å¡';
                let afternoonStatus = 'æœªæ‰“å¡';
                
                // å¦‚æœæœ‰è®°å½•ï¼Œä½¿ç”¨è®°å½•ä¸­çš„çŠ¶æ€
                if (record) {
                    morningStatus = record.morningStatus;
                    afternoonStatus = record.afternoonStatus;
                }
                
                // åˆ›å»ºæ—¥æœŸæ ¼å­
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                // åˆ¤æ–­æ˜¯å¦æ˜¯ä»Šå¤©
                const today = new Date();
                const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                
                // è®¾ç½®æ—¥æœŸæ ¼å­å†…å®¹ï¼Œåˆ†ä¸¤è¡Œæ˜¾ç¤ºä¸Šåˆå’Œä¸‹åˆçŠ¶æ€
                dayEl.innerHTML = `
                    <div class="day-number" style="${isToday ? 'background-color: #e6f7ff; color: #409eff;' : ''}">
                        ${day}
                    </div>
                    <div class="status-container">
                        <div class="status-cell ${getStatusClass(morningStatus)}">
                            ${getStatusText(morningStatus)}
                        </div>
                        <div class="status-cell ${getStatusClass(afternoonStatus)}">
                            ${getStatusText(afternoonStatus)}
                        </div>
                    </div>
                `;
                
                calendarGrid.appendChild(dayEl);
            }
        }
        
        // è·å–çŠ¶æ€å¯¹åº”çš„CSSç±»
        function getStatusClass(status) {
            switch(status) {
                case 'æ‰“å¡': return 'status-present';
                case 'ä¼‘ç­': return 'status-rest';
                case 'æœªæ‰“å¡': return 'status-absent';
                default: return '';
            }
        }
        
        // è·å–çŠ¶æ€å¯¹åº”çš„æ–‡æœ¬
        function getStatusText(status) {
            switch(status) {
                case 'æ‰“å¡': return 'âˆš';
                case 'ä¼‘ç­': return 'ä¼‘';
                case 'æœªæ‰“å¡': return 'X';
                default: return '';
            }
        }
        
        // åˆ‡æ¢æœˆä»½
        function changeMonth(direction) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + direction);
            renderCalendar();
        }
    </script>
</body>
</html>